<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>handlebars.c: handlebars_cache_mmap.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">handlebars.c
   &#160;<span id="projectnumber">0.6.0</span>
   </div>
   <div id="projectbrief">Libraryforhandlebars</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('handlebars__cache__mmap_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">handlebars_cache_mmap.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/file.h&gt;</code><br />
<code>#include &lt;sys/mman.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="handlebars_8h_source.html">handlebars.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="handlebars__memory_8h_source.html">handlebars_memory.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="handlebars__private_8h_source.html">handlebars_private.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="handlebars__cache_8h_source.html">handlebars_cache.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="handlebars__map_8h_source.html">handlebars_map.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="handlebars__string_8h_source.html">handlebars_string.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="handlebars__value_8h_source.html">handlebars_value.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="handlebars__opcode__serializer_8h_source.html">handlebars_opcode_serializer.h</a>&quot;</code><br />
</div>
<p><a href="handlebars__cache__mmap_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtable__entry.html">table_entry</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af195e2296079bbf21ae1c19823f0f036"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#af195e2296079bbf21ae1c19823f0f036">CONTEXT</a>&#160;&#160;&#160;<a class="el" href="handlebars_8h.html#aeaa554d04fd9ac8b882e4fdf0dc44264">HBSCTX</a>(cache)</td></tr>
<tr class="separator:af195e2296079bbf21ae1c19823f0f036"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c071bfb72a8294b36426ac580e59b46"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a1c071bfb72a8294b36426ac580e59b46">USE_SPINLOCK</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a1c071bfb72a8294b36426ac580e59b46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeea93922c7a9e9b51d2bbe9d8cb680ae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#aeea93922c7a9e9b51d2bbe9d8cb680ae">INCR</a>(var)&#160;&#160;&#160;<a class="el" href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a>(cache); var++; <a class="el" href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a>(cache)</td></tr>
<tr class="separator:aeea93922c7a9e9b51d2bbe9d8cb680ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae95d420c3ab7d21c49094bec26c48a2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#aae95d420c3ab7d21c49094bec26c48a2">DECR</a>(var)&#160;&#160;&#160;<a class="el" href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a>(cache); var--; <a class="el" href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a>(cache)</td></tr>
<tr class="separator:aae95d420c3ab7d21c49094bec26c48a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af195e2296079bbf21ae1c19823f0f036"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#af195e2296079bbf21ae1c19823f0f036">CONTEXT</a>&#160;&#160;&#160;context</td></tr>
<tr class="separator:af195e2296079bbf21ae1c19823f0f036"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a74942634f14b677d6420778c681e5eee"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a74942634f14b677d6420778c681e5eee">align_size</a> (size_t size)</td></tr>
<tr class="separator:a74942634f14b677d6420778c681e5eee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a374ab73285cc1fa0624b029e1f7a043c"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a374ab73285cc1fa0624b029e1f7a043c">append</a> (struct <a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *intern, void *source, size_t size)</td></tr>
<tr class="separator:a374ab73285cc1fa0624b029e1f7a043c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f6245176e76ca20c7087559c7a5f0bb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a> (struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *cache, bool on)</td></tr>
<tr class="separator:a4f6245176e76ca20c7087559c7a5f0bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25bd7b8b00a11adafa646b226ad9607f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a> (struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *cache)</td></tr>
<tr class="separator:a25bd7b8b00a11adafa646b226ad9607f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a106761eefc3d370d212d906297ccef3f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a> (struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *cache)</td></tr>
<tr class="separator:a106761eefc3d370d212d906297ccef3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1733dcac1d772cc39819b5427c8a1703"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a1733dcac1d772cc39819b5427c8a1703">table_exists</a> (struct <a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *intern, struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *<a class="el" href="handlebars__string_8h.html#ae95097e7b19d03467506a1b14ae1355e">string</a>)</td></tr>
<tr class="separator:a1733dcac1d772cc39819b5427c8a1703"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a23bf622f8c72bdcadb41f78ab4d49c"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structtable__entry.html">table_entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a2a23bf622f8c72bdcadb41f78ab4d49c">table_find</a> (struct <a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *intern, struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *<a class="el" href="handlebars__string_8h.html#ae95097e7b19d03467506a1b14ae1355e">string</a>)</td></tr>
<tr class="separator:a2a23bf622f8c72bdcadb41f78ab4d49c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b8d6650dd1fe5567000229958d68c69"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a2b8d6650dd1fe5567000229958d68c69">table_set</a> (struct <a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *intern, struct <a class="el" href="structtable__entry.html">table_entry</a> *entry)</td></tr>
<tr class="separator:a2b8d6650dd1fe5567000229958d68c69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0548dbe473ec67a6e1365752df9b476"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#ad0548dbe473ec67a6e1365752df9b476">table_unset</a> (struct <a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *intern, struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *<a class="el" href="handlebars__string_8h.html#ae95097e7b19d03467506a1b14ae1355e">string</a>)</td></tr>
<tr class="separator:ad0548dbe473ec67a6e1365752df9b476"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64d298d4e018b19fed9ed107eb040c3c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a64d298d4e018b19fed9ed107eb040c3c">cache_dtor</a> (struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *cache)</td></tr>
<tr class="separator:a64d298d4e018b19fed9ed107eb040c3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac5cf4d9696fde58dbde385f86b9efc8"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#aac5cf4d9696fde58dbde385f86b9efc8">cache_reset</a> (struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *cache)</td></tr>
<tr class="separator:aac5cf4d9696fde58dbde385f86b9efc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb3159a37e6e5e2b339e2bd4159f51dc"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#adb3159a37e6e5e2b339e2bd4159f51dc">cache_gc</a> (struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *cache)</td></tr>
<tr class="separator:adb3159a37e6e5e2b339e2bd4159f51dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab97827ab3064e100bab8d45a88320bb9"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structhandlebars__module.html">handlebars_module</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#ab97827ab3064e100bab8d45a88320bb9">cache_find</a> (struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *cache, struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *key)</td></tr>
<tr class="separator:ab97827ab3064e100bab8d45a88320bb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac55c4b65fbb66d868640c5892cf8b181"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#ac55c4b65fbb66d868640c5892cf8b181">cache_add</a> (struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *cache, struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *key, struct <a class="el" href="structhandlebars__module.html">handlebars_module</a> *module)</td></tr>
<tr class="separator:ac55c4b65fbb66d868640c5892cf8b181"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62b4d5cb0eae7108d0df7f1af2395f65"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a62b4d5cb0eae7108d0df7f1af2395f65">cache_release</a> (struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *cache, struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *tmpl, struct <a class="el" href="structhandlebars__module.html">handlebars_module</a> *module)</td></tr>
<tr class="separator:a62b4d5cb0eae7108d0df7f1af2395f65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af79331ff1183a715cb149247f955d0a7"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structhandlebars__cache__stat.html">handlebars_cache_stat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#af79331ff1183a715cb149247f955d0a7">cache_stat</a> (struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *cache)</td></tr>
<tr class="separator:af79331ff1183a715cb149247f955d0a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abad5da6309de6d623994e1a0f3493994"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#abad5da6309de6d623994e1a0f3493994">handlebars_cache_mmap_ctor</a> (struct <a class="el" href="structhandlebars__context.html">handlebars_context</a> *context, size_t size, size_t entries)</td></tr>
<tr class="memdesc:abad5da6309de6d623994e1a0f3493994"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a new mmap cache.  <a href="#abad5da6309de6d623994e1a0f3493994">More...</a><br /></td></tr>
<tr class="separator:abad5da6309de6d623994e1a0f3493994"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac681967740693099a0ea2318b241af65"><td class="memItemLeft" align="right" valign="top">static const char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#ac681967740693099a0ea2318b241af65">head</a> [] = &quot;handlebars shared opcode cache&quot;</td></tr>
<tr class="separator:ac681967740693099a0ea2318b241af65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a799a580f85b3c4f9a3689f904c4f21d3"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#a799a580f85b3c4f9a3689f904c4f21d3">PADDING</a> = 1</td></tr>
<tr class="separator:a799a580f85b3c4f9a3689f904c4f21d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af91f634fbc8d26e705035b0613f7d077"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handlebars__cache__mmap_8c.html#af91f634fbc8d26e705035b0613f7d077">page_size</a></td></tr>
<tr class="separator:af91f634fbc8d26e705035b0613f7d077"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="af195e2296079bbf21ae1c19823f0f036"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONTEXT&#160;&#160;&#160;<a class="el" href="handlebars_8h.html#aeaa554d04fd9ac8b882e4fdf0dc44264">HBSCTX</a>(cache)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Copyright (C) 2016 John Boehr</p>
<p>This file is part of <a class="el" href="handlebars_8c.html">handlebars.c</a>.</p>
<p><a class="el" href="handlebars_8c.html">handlebars.c</a> is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either version 2.1 of the License, or (at your option) any later version.</p>
<p><a class="el" href="handlebars_8c.html">handlebars.c</a> is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.</p>
<p>You should have received a copy of the GNU Lesser General Public License along with <a class="el" href="handlebars_8c.html">handlebars.c</a>. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. </p>

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00411">411</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>

</div>
</div>
<a class="anchor" id="af195e2296079bbf21ae1c19823f0f036"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONTEXT&#160;&#160;&#160;context</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Copyright (C) 2016 John Boehr</p>
<p>This file is part of <a class="el" href="handlebars_8c.html">handlebars.c</a>.</p>
<p><a class="el" href="handlebars_8c.html">handlebars.c</a> is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either version 2.1 of the License, or (at your option) any later version.</p>
<p><a class="el" href="handlebars_8c.html">handlebars.c</a> is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.</p>
<p>You should have received a copy of the GNU Lesser General Public License along with <a class="el" href="handlebars_8c.html">handlebars.c</a>. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. </p>

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00411">411</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>

</div>
</div>
<a class="anchor" id="aae95d420c3ab7d21c49094bec26c48a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DECR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">var</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a>(cache); var--; <a class="el" href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a>(cache)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00218">218</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>

</div>
</div>
<a class="anchor" id="aeea93922c7a9e9b51d2bbe9d8cb680ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INCR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">var</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a>(cache); var++; <a class="el" href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a>(cache)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00217">217</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1c071bfb72a8294b36426ac580e59b46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USE_SPINLOCK&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00056">56</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a74942634f14b677d6420778c681e5eee"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t align_size </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00122">122</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;{</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">size_t</span> pages = (size / <a class="code" href="handlebars__cache__mmap_8c.html#af91f634fbc8d26e705035b0613f7d077">page_size</a>);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">if</span>( size % <a class="code" href="handlebars__cache__mmap_8c.html#af91f634fbc8d26e705035b0613f7d077">page_size</a> != 0 ) {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        pages++;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">return</span> pages * <a class="code" href="handlebars__cache__mmap_8c.html#af91f634fbc8d26e705035b0613f7d077">page_size</a>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div><div class="ttc" id="handlebars__cache__mmap_8c_html_af91f634fbc8d26e705035b0613f7d077"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#af91f634fbc8d26e705035b0613f7d077">page_size</a></div><div class="ttdeci">static size_t page_size</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00061">handlebars_cache_mmap.c:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a374ab73285cc1fa0624b029e1f7a043c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* append </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *&#160;</td>
          <td class="paramname"><em>intern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00131">131</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">void</span> * addr = intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a7e07fa52d80d3bfe23ef2f191334c178">data</a> + intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a05dd28d3d3bf0fc057e5cb4c160443ba">data_length</a>;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">if</span>( intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a05dd28d3d3bf0fc057e5cb4c160443ba">data_length</a> + size + <a class="code" href="handlebars__cache__mmap_8c.html#a799a580f85b3c4f9a3689f904c4f21d3">PADDING</a> &gt;= intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a8450774fdeadcddcb022b007eb315ba4">data_size</a> ) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a05dd28d3d3bf0fc057e5cb4c160443ba">data_length</a> += size + <a class="code" href="handlebars__cache__mmap_8c.html#a799a580f85b3c4f9a3689f904c4f21d3">PADDING</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="handlebars__string_8h.html#a63c99b5ce4c89deb54bb53514278027a">memcpy</a>(addr, source, size);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    memset(addr + size, 0, PADDING);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">return</span> addr;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;}</div><div class="ttc" id="handlebars__cache__mmap_8c_html_a799a580f85b3c4f9a3689f904c4f21d3"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a799a580f85b3c4f9a3689f904c4f21d3">PADDING</a></div><div class="ttdeci">static const size_t PADDING</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00060">handlebars_cache_mmap.c:60</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a05dd28d3d3bf0fc057e5cb4c160443ba"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a05dd28d3d3bf0fc057e5cb4c160443ba">handlebars_cache_mmap::data_length</a></div><div class="ttdeci">size_t data_length</div><div class="ttdoc">The length in bytes of the currently used part of the data segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00095">handlebars_cache_mmap.c:95</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a8450774fdeadcddcb022b007eb315ba4"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a8450774fdeadcddcb022b007eb315ba4">handlebars_cache_mmap::data_size</a></div><div class="ttdeci">size_t data_size</div><div class="ttdoc">The size in bytes of the data segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00092">handlebars_cache_mmap.c:92</a></div></div>
<div class="ttc" id="handlebars__string_8h_html_a63c99b5ce4c89deb54bb53514278027a"><div class="ttname"><a href="handlebars__string_8h.html#a63c99b5ce4c89deb54bb53514278027a">memcpy</a></div><div class="ttdeci">memcpy(st-&gt;val, str, len)</div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a7e07fa52d80d3bfe23ef2f191334c178"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a7e07fa52d80d3bfe23ef2f191334c178">handlebars_cache_mmap::data</a></div><div class="ttdeci">void * data</div><div class="ttdoc">The pointer to the data segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00089">handlebars_cache_mmap.c:89</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac55c4b65fbb66d868640c5892cf8b181"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void cache_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td>
          <td class="paramname"><em>cache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__module.html">handlebars_module</a> *&#160;</td>
          <td class="paramname"><em>module</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00329">329</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> * intern = (<span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *) cache-&gt;<a class="code" href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">internal</a>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keyword">struct</span> <a class="code" href="structtable__entry.html">table_entry</a> entry;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">// Currently resetting</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span>( intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a620b2172f6534dfd74567c8559890d81">in_reset</a> ) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">// Lock</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a>(cache, <span class="keyword">false</span>);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a>(cache);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    assert(module == module-&gt;<a class="code" href="structhandlebars__module.html#a648a4daba06ff5f08129370995a9f9ff">addr</a>);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">// Collision</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtable__entry.html">table_entry</a> * found = <a class="code" href="handlebars__cache__mmap_8c.html#a2a23bf622f8c72bdcadb41f78ab4d49c">table_find</a>(intern, key);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">if</span>( found ) {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="handlebars__string_8h.html#a52a339c32a3d5fa278301debd5ba7e52">handlebars_string_eq</a>(found-&gt;<a class="code" href="structtable__entry.html#aa866208546b2c698d292d66968992733">key</a>, key) ) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            <a class="code" href="handlebars__cache__mmap_8c.html#aeea93922c7a9e9b51d2bbe9d8cb680ae">INCR</a>(intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a8d0fec721f88c3649e2f412a76eaee9f">collisions</a>);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">// Copy key</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    entry.key = <a class="code" href="handlebars__cache__mmap_8c.html#a374ab73285cc1fa0624b029e1f7a043c">append</a>(intern, (<span class="keywordtype">void</span> *) key, <a class="code" href="handlebars__string_8h.html#aafb4252efe8048cfe9cd6f7fedcc4151">HBS_STR_SIZE</a>(key-&gt;<a class="code" href="structhandlebars__string.html#a857b514c991646164995d912822c4e93">len</a>));</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// Copy data</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    entry.data = <a class="code" href="handlebars__cache__mmap_8c.html#a374ab73285cc1fa0624b029e1f7a043c">append</a>(intern, (<span class="keywordtype">void</span> *) module, module-&gt;<a class="code" href="structhandlebars__module.html#a19ac1f01ef3772ac8325348b26c744b5">size</a>);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">// Check for failure</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="handlebars__private_8h.html#a8aeff48085ffee92c9b70f7227b62925">unlikely</a>(!entry.key || !entry.data) ) {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <a class="code" href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a>(cache);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <a class="code" href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a>(cache, <span class="keyword">true</span>);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <a class="code" href="handlebars__cache__mmap_8c.html#aac5cf4d9696fde58dbde385f86b9efc8">cache_reset</a>(cache);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// Pre-patch pointers</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="handlebars__opcode__serializer_8c.html#a0c46d35b83f1bcc02182f1af4ab5ebc8">handlebars_module_patch_pointers</a>(entry.data);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">// Finish;</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#a2b8d6650dd1fe5567000229958d68c69">table_set</a>(intern, &amp;entry);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a9e911424e11626d1ca5fa4ad0fe12f79">table_entries</a>++;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;error:</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// Unlock</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a>(cache);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a>(cache, <span class="keyword">true</span>);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div><div class="ttc" id="handlebars__string_8h_html_a52a339c32a3d5fa278301debd5ba7e52"><div class="ttname"><a href="handlebars__string_8h.html#a52a339c32a3d5fa278301debd5ba7e52">handlebars_string_eq</a></div><div class="ttdeci">static bool handlebars_string_eq(struct handlebars_string *string1, struct handlebars_string *string2)</div><div class="ttdoc">Compare two strings (handlebars_string variant) </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__string_8h_source.html#l00247">handlebars_string.h:247</a></div></div>
<div class="ttc" id="handlebars__private_8h_html_a8aeff48085ffee92c9b70f7227b62925"><div class="ttname"><a href="handlebars__private_8h.html#a8aeff48085ffee92c9b70f7227b62925">unlikely</a></div><div class="ttdeci">#define unlikely</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__private_8h_source.html#l00032">handlebars_private.h:32</a></div></div>
<div class="ttc" id="structhandlebars__string_html_a857b514c991646164995d912822c4e93"><div class="ttname"><a href="structhandlebars__string.html#a857b514c991646164995d912822c4e93">handlebars_string::len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__string_8h_source.html#l00040">handlebars_string.h:40</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_aac5cf4d9696fde58dbde385f86b9efc8"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#aac5cf4d9696fde58dbde385f86b9efc8">cache_reset</a></div><div class="ttdeci">static void cache_reset(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00231">handlebars_cache_mmap.c:231</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_ae62d0123ba88d34c14e6aa31cff58a6b"><div class="ttname"><a href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">handlebars_cache::internal</a></div><div class="ttdeci">void * internal</div><div class="ttdoc">Opaque pointer for implementation use. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00118">handlebars_cache.h:118</a></div></div>
<div class="ttc" id="structhandlebars__module_html_a19ac1f01ef3772ac8325348b26c744b5"><div class="ttname"><a href="structhandlebars__module.html#a19ac1f01ef3772ac8325348b26c744b5">handlebars_module::size</a></div><div class="ttdeci">size_t size</div><div class="ttdoc">The size of the struct and all children. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__opcode__serializer_8h_source.html#l00062">handlebars_opcode_serializer.h:62</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_aeea93922c7a9e9b51d2bbe9d8cb680ae"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#aeea93922c7a9e9b51d2bbe9d8cb680ae">INCR</a></div><div class="ttdeci">#define INCR(var)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00217">handlebars_cache_mmap.c:217</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html"><div class="ttname"><a href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00063">handlebars_cache_mmap.c:63</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a4f6245176e76ca20c7087559c7a5f0bb"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a></div><div class="ttdeci">static void protect(struct handlebars_cache *cache, bool on)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00143">handlebars_cache_mmap.c:143</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a106761eefc3d370d212d906297ccef3f"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a></div><div class="ttdeci">static void unlock(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00169">handlebars_cache_mmap.c:169</a></div></div>
<div class="ttc" id="handlebars__string_8h_html_aafb4252efe8048cfe9cd6f7fedcc4151"><div class="ttname"><a href="handlebars__string_8h.html#aafb4252efe8048cfe9cd6f7fedcc4151">HBS_STR_SIZE</a></div><div class="ttdeci">#define HBS_STR_SIZE(length)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__string_8h_source.html#l00048">handlebars_string.h:48</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a9e911424e11626d1ca5fa4ad0fe12f79"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a9e911424e11626d1ca5fa4ad0fe12f79">handlebars_cache_mmap::table_entries</a></div><div class="ttdeci">size_t table_entries</div><div class="ttdoc">The number of used slots in the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00086">handlebars_cache_mmap.c:86</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a2b8d6650dd1fe5567000229958d68c69"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a2b8d6650dd1fe5567000229958d68c69">table_set</a></div><div class="ttdeci">static void table_set(struct handlebars_cache_mmap *intern, struct table_entry *entry)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00197">handlebars_cache_mmap.c:197</a></div></div>
<div class="ttc" id="structtable__entry_html_aa866208546b2c698d292d66968992733"><div class="ttname"><a href="structtable__entry.html#aa866208546b2c698d292d66968992733">table_entry::key</a></div><div class="ttdeci">struct handlebars_string * key</div><div class="ttdoc">The offset from the beginning of the memory block at which the key for the entry resides. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00116">handlebars_cache_mmap.c:116</a></div></div>
<div class="ttc" id="structhandlebars__module_html_a648a4daba06ff5f08129370995a9f9ff"><div class="ttname"><a href="structhandlebars__module.html#a648a4daba06ff5f08129370995a9f9ff">handlebars_module::addr</a></div><div class="ttdeci">void * addr</div><div class="ttdoc">The original address of the struct used to fix internal pointers. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__opcode__serializer_8h_source.html#l00059">handlebars_opcode_serializer.h:59</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a25bd7b8b00a11adafa646b226ad9607f"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a></div><div class="ttdeci">static void lock(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00153">handlebars_cache_mmap.c:153</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a2a23bf622f8c72bdcadb41f78ab4d49c"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a2a23bf622f8c72bdcadb41f78ab4d49c">table_find</a></div><div class="ttdeci">static struct table_entry * table_find(struct handlebars_cache_mmap *intern, struct handlebars_string *string)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00191">handlebars_cache_mmap.c:191</a></div></div>
<div class="ttc" id="handlebars__opcode__serializer_8c_html_a0c46d35b83f1bcc02182f1af4ab5ebc8"><div class="ttname"><a href="handlebars__opcode__serializer_8c.html#a0c46d35b83f1bcc02182f1af4ab5ebc8">handlebars_module_patch_pointers</a></div><div class="ttdeci">void handlebars_module_patch_pointers(struct handlebars_module *module)</div><div class="ttdoc">Fix any pointers by adjusting by the offset between the address of module and handlebars_module::addr...</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__opcode__serializer_8c_source.html#l00265">handlebars_opcode_serializer.c:265</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a620b2172f6534dfd74567c8559890d81"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a620b2172f6534dfd74567c8559890d81">handlebars_cache_mmap::in_reset</a></div><div class="ttdeci">bool in_reset</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00103">handlebars_cache_mmap.c:103</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a8d0fec721f88c3649e2f412a76eaee9f"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a8d0fec721f88c3649e2f412a76eaee9f">handlebars_cache_mmap::collisions</a></div><div class="ttdeci">size_t collisions</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00101">handlebars_cache_mmap.c:101</a></div></div>
<div class="ttc" id="structtable__entry_html"><div class="ttname"><a href="structtable__entry.html">table_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00114">handlebars_cache_mmap.c:114</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a374ab73285cc1fa0624b029e1f7a043c"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a374ab73285cc1fa0624b029e1f7a043c">append</a></div><div class="ttdeci">static void * append(struct handlebars_cache_mmap *intern, void *source, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00131">handlebars_cache_mmap.c:131</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a64d298d4e018b19fed9ed107eb040c3c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void cache_dtor </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td>
          <td class="paramname"><em>cache</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00221">221</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;{</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// This may be unnecessary with MAP_ANONYMOUS</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> * intern = (<span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *) cache-&gt;<a class="code" href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">internal</a>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span>( intern ) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        munmap(intern, intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a4016bb37756b65c2bc2e3620fe0da001">size</a>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// @todo do we need to release the mutexes?</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div><div class="ttc" id="structhandlebars__cache_html_ae62d0123ba88d34c14e6aa31cff58a6b"><div class="ttname"><a href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">handlebars_cache::internal</a></div><div class="ttdeci">void * internal</div><div class="ttdoc">Opaque pointer for implementation use. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00118">handlebars_cache.h:118</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html"><div class="ttname"><a href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00063">handlebars_cache_mmap.c:63</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a4016bb37756b65c2bc2e3620fe0da001"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a4016bb37756b65c2bc2e3620fe0da001">handlebars_cache_mmap::size</a></div><div class="ttdeci">size_t size</div><div class="ttdoc">The size of the memory block. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00068">handlebars_cache_mmap.c:68</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab97827ab3064e100bab8d45a88320bb9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structhandlebars__module.html">handlebars_module</a>* cache_find </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td>
          <td class="paramname"><em>cache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00274">274</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> * intern = (<span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *) cache-&gt;<a class="code" href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">internal</a>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keyword">struct</span> <a class="code" href="structhandlebars__module.html">handlebars_module</a> * module = NULL;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    time_t now;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// Currently resetting</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span>( intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a620b2172f6534dfd74567c8559890d81">in_reset</a> ) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// Find entry</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtable__entry.html">table_entry</a> * entry = <a class="code" href="handlebars__cache__mmap_8c.html#a2a23bf622f8c72bdcadb41f78ab4d49c">table_find</a>(intern, key);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span>( !entry ) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="comment">// Not found, or not ready</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <a class="code" href="handlebars__cache__mmap_8c.html#aeea93922c7a9e9b51d2bbe9d8cb680ae">INCR</a>(intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a32f73042b22293ef3fbc1c252ccd00a8">misses</a>);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// Compare key</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="handlebars__string_8h.html#a52a339c32a3d5fa278301debd5ba7e52">handlebars_string_eq</a>(key, entry-&gt;<a class="code" href="structtable__entry.html#aa866208546b2c698d292d66968992733">key</a>) ) {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="handlebars__cache__mmap_8c.html#aeea93922c7a9e9b51d2bbe9d8cb680ae">INCR</a>(intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a32f73042b22293ef3fbc1c252ccd00a8">misses</a>);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="comment">//INCR(intern-&gt;collisions);</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">// Get data</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    module = entry-&gt;<a class="code" href="structtable__entry.html#a0541eda12189a3068caf00d5037b7f01">data</a>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// Check if it&#39;s too old or wrong version</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    time(&amp;now);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">if</span>( module-&gt;version != <a class="code" href="handlebars_8c.html#ab47ffc947fd2d7d4488f85a269e289af">handlebars_version</a>() || (cache-&gt;<a class="code" href="structhandlebars__cache.html#a5e03e6bcdb242893423b04205d430121">max_age</a> &gt;= 0 &amp;&amp; difftime(now, module-&gt;ts) &gt;= cache-&gt;<a class="code" href="structhandlebars__cache.html#a5e03e6bcdb242893423b04205d430121">max_age</a>) ) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <a class="code" href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a>(cache, <span class="keyword">false</span>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <a class="code" href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a>(cache);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <a class="code" href="handlebars__cache__mmap_8c.html#ad0548dbe473ec67a6e1365752df9b476">table_unset</a>(intern, key);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a32f73042b22293ef3fbc1c252ccd00a8">misses</a>++;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a9e911424e11626d1ca5fa4ad0fe12f79">table_entries</a>--;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <a class="code" href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a>(cache);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <a class="code" href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a>(cache, <span class="keyword">true</span>);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    }</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="comment">// Check for pointer mismatch</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="handlebars__private_8h.html#a8aeff48085ffee92c9b70f7227b62925">unlikely</a>((<span class="keywordtype">void</span> *) module != module-&gt;addr) ) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <a class="code" href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a>(<a class="code" href="handlebars__cache__mmap_8c.html#af195e2296079bbf21ae1c19823f0f036">CONTEXT</a>, <a class="code" href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a>, <span class="stringliteral">&quot;Shared memory pointer mismatch: %p != %p&quot;</span>, module, module-&gt;addr);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#aeea93922c7a9e9b51d2bbe9d8cb680ae">INCR</a>(intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#ab3cc925fe223d080a5649481bb708bb3">hits</a>);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#aeea93922c7a9e9b51d2bbe9d8cb680ae">INCR</a>(intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a0bfb85a2a23102bda433e62e5ca22bc2">refcount</a>);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;error:</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">return</span> module;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div><div class="ttc" id="structhandlebars__cache__mmap_html_a0bfb85a2a23102bda433e62e5ca22bc2"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a0bfb85a2a23102bda433e62e5ca22bc2">handlebars_cache_mmap::refcount</a></div><div class="ttdeci">long refcount</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00111">handlebars_cache_mmap.c:111</a></div></div>
<div class="ttc" id="structhandlebars__module_html"><div class="ttname"><a href="structhandlebars__module.html">handlebars_module</a></div><div class="ttdoc">Serialized program. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__opcode__serializer_8h_source.html#l00053">handlebars_opcode_serializer.h:53</a></div></div>
<div class="ttc" id="handlebars__string_8h_html_a52a339c32a3d5fa278301debd5ba7e52"><div class="ttname"><a href="handlebars__string_8h.html#a52a339c32a3d5fa278301debd5ba7e52">handlebars_string_eq</a></div><div class="ttdeci">static bool handlebars_string_eq(struct handlebars_string *string1, struct handlebars_string *string2)</div><div class="ttdoc">Compare two strings (handlebars_string variant) </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__string_8h_source.html#l00247">handlebars_string.h:247</a></div></div>
<div class="ttc" id="handlebars__private_8h_html_a8aeff48085ffee92c9b70f7227b62925"><div class="ttname"><a href="handlebars__private_8h.html#a8aeff48085ffee92c9b70f7227b62925">unlikely</a></div><div class="ttdeci">#define unlikely</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__private_8h_source.html#l00032">handlebars_private.h:32</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_ae62d0123ba88d34c14e6aa31cff58a6b"><div class="ttname"><a href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">handlebars_cache::internal</a></div><div class="ttdeci">void * internal</div><div class="ttdoc">Opaque pointer for implementation use. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00118">handlebars_cache.h:118</a></div></div>
<div class="ttc" id="handlebars_8c_html_ae53cf83b47627706cdc4143e5c6a4afe"><div class="ttname"><a href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a></div><div class="ttdeci">void handlebars_throw(struct handlebars_context *context, enum handlebars_error_type num, const char *msg,...)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8c_source.html#l00299">handlebars.c:299</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_aeea93922c7a9e9b51d2bbe9d8cb680ae"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#aeea93922c7a9e9b51d2bbe9d8cb680ae">INCR</a></div><div class="ttdeci">#define INCR(var)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00217">handlebars_cache_mmap.c:217</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html"><div class="ttname"><a href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00063">handlebars_cache_mmap.c:63</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a4f6245176e76ca20c7087559c7a5f0bb"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a></div><div class="ttdeci">static void protect(struct handlebars_cache *cache, bool on)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00143">handlebars_cache_mmap.c:143</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a106761eefc3d370d212d906297ccef3f"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a></div><div class="ttdeci">static void unlock(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00169">handlebars_cache_mmap.c:169</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a32f73042b22293ef3fbc1c252ccd00a8"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a32f73042b22293ef3fbc1c252ccd00a8">handlebars_cache_mmap::misses</a></div><div class="ttdeci">size_t misses</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00099">handlebars_cache_mmap.c:99</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a9e911424e11626d1ca5fa4ad0fe12f79"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a9e911424e11626d1ca5fa4ad0fe12f79">handlebars_cache_mmap::table_entries</a></div><div class="ttdeci">size_t table_entries</div><div class="ttdoc">The number of used slots in the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00086">handlebars_cache_mmap.c:86</a></div></div>
<div class="ttc" id="structtable__entry_html_aa866208546b2c698d292d66968992733"><div class="ttname"><a href="structtable__entry.html#aa866208546b2c698d292d66968992733">table_entry::key</a></div><div class="ttdeci">struct handlebars_string * key</div><div class="ttdoc">The offset from the beginning of the memory block at which the key for the entry resides. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00116">handlebars_cache_mmap.c:116</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_ab3cc925fe223d080a5649481bb708bb3"><div class="ttname"><a href="structhandlebars__cache__mmap.html#ab3cc925fe223d080a5649481bb708bb3">handlebars_cache_mmap::hits</a></div><div class="ttdeci">size_t hits</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00097">handlebars_cache_mmap.c:97</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a25bd7b8b00a11adafa646b226ad9607f"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a></div><div class="ttdeci">static void lock(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00153">handlebars_cache_mmap.c:153</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a2a23bf622f8c72bdcadb41f78ab4d49c"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a2a23bf622f8c72bdcadb41f78ab4d49c">table_find</a></div><div class="ttdeci">static struct table_entry * table_find(struct handlebars_cache_mmap *intern, struct handlebars_string *string)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00191">handlebars_cache_mmap.c:191</a></div></div>
<div class="ttc" id="handlebars_8c_html_ab47ffc947fd2d7d4488f85a269e289af"><div class="ttname"><a href="handlebars_8c.html#ab47ffc947fd2d7d4488f85a269e289af">handlebars_version</a></div><div class="ttdeci">int handlebars_version(void)</div><div class="ttdoc">Get the library version as an integer. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8c_source.html#l00044">handlebars.c:44</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a620b2172f6534dfd74567c8559890d81"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a620b2172f6534dfd74567c8559890d81">handlebars_cache_mmap::in_reset</a></div><div class="ttdeci">bool in_reset</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00103">handlebars_cache_mmap.c:103</a></div></div>
<div class="ttc" id="structtable__entry_html_a0541eda12189a3068caf00d5037b7f01"><div class="ttname"><a href="structtable__entry.html#a0541eda12189a3068caf00d5037b7f01">table_entry::data</a></div><div class="ttdeci">void * data</div><div class="ttdoc">The offset from the beginning of the memory block at which the data for this entry resides...</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00119">handlebars_cache_mmap.c:119</a></div></div>
<div class="ttc" id="structtable__entry_html"><div class="ttname"><a href="structtable__entry.html">table_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00114">handlebars_cache_mmap.c:114</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_af195e2296079bbf21ae1c19823f0f036"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#af195e2296079bbf21ae1c19823f0f036">CONTEXT</a></div><div class="ttdeci">#define CONTEXT</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00411">handlebars_cache_mmap.c:411</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_a5e03e6bcdb242893423b04205d430121"><div class="ttname"><a href="structhandlebars__cache.html#a5e03e6bcdb242893423b04205d430121">handlebars_cache::max_age</a></div><div class="ttdeci">double max_age</div><div class="ttdoc">The max amount of time to keep an entry, in seconds, or zero to disable. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00133">handlebars_cache.h:133</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_ad0548dbe473ec67a6e1365752df9b476"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#ad0548dbe473ec67a6e1365752df9b476">table_unset</a></div><div class="ttdeci">static void table_unset(struct handlebars_cache_mmap *intern, struct handlebars_string *string)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00207">handlebars_cache_mmap.c:207</a></div></div>
<div class="ttc" id="handlebars_8h_html_a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67"><div class="ttname"><a href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a></div><div class="ttdoc">Indicates that a generic error has occurred. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8h_source.html#l00119">handlebars.h:119</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adb3159a37e6e5e2b339e2bd4159f51dc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int cache_gc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td>
          <td class="paramname"><em>cache</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00267">267</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;{</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">// @todo</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a62b4d5cb0eae7108d0df7f1af2395f65"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void cache_release </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td>
          <td class="paramname"><em>cache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *&#160;</td>
          <td class="paramname"><em>tmpl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__module.html">handlebars_module</a> *&#160;</td>
          <td class="paramname"><em>module</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00384">384</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;{</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> * intern = (<span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *) cache-&gt;<a class="code" href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">internal</a>;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#aae95d420c3ab7d21c49094bec26c48a2">DECR</a>(intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a0bfb85a2a23102bda433e62e5ca22bc2">refcount</a>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div><div class="ttc" id="structhandlebars__cache__mmap_html_a0bfb85a2a23102bda433e62e5ca22bc2"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a0bfb85a2a23102bda433e62e5ca22bc2">handlebars_cache_mmap::refcount</a></div><div class="ttdeci">long refcount</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00111">handlebars_cache_mmap.c:111</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_ae62d0123ba88d34c14e6aa31cff58a6b"><div class="ttname"><a href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">handlebars_cache::internal</a></div><div class="ttdeci">void * internal</div><div class="ttdoc">Opaque pointer for implementation use. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00118">handlebars_cache.h:118</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html"><div class="ttname"><a href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00063">handlebars_cache_mmap.c:63</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_aae95d420c3ab7d21c49094bec26c48a2"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#aae95d420c3ab7d21c49094bec26c48a2">DECR</a></div><div class="ttdeci">#define DECR(var)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00218">handlebars_cache_mmap.c:218</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aac5cf4d9696fde58dbde385f86b9efc8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void cache_reset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td>
          <td class="paramname"><em>cache</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00231">231</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> * intern = (<span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *) cache-&gt;<a class="code" href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">internal</a>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// Lock</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a620b2172f6534dfd74567c8559890d81">in_reset</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// Try to wait for refcount to empty</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordtype">int</span> counter = 0;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">while</span>( intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a0bfb85a2a23102bda433e62e5ca22bc2">refcount</a> &gt; 0 &amp;&amp; ++counter &lt;= 100 ) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        usleep(5000);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span>( intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a0bfb85a2a23102bda433e62e5ca22bc2">refcount</a> &gt; 0 ) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// Unprotect/Lock</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a>(cache, <span class="keyword">false</span>);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a>(cache);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">// Initialize header</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a9e911424e11626d1ca5fa4ad0fe12f79">table_entries</a> = 0;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a05dd28d3d3bf0fc057e5cb4c160443ba">data_length</a> = 0;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment">// Zero out the hash table</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    memset(intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">table</a>, 0, intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a97204788ab4999d7fa6db5c8add14ed5">table_size</a>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// Protect/Unlock</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a>(cache);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a>(cache, <span class="keyword">true</span>);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;error:</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// Unlock</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a620b2172f6534dfd74567c8559890d81">in_reset</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div><div class="ttc" id="structhandlebars__cache__mmap_html_a0bfb85a2a23102bda433e62e5ca22bc2"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a0bfb85a2a23102bda433e62e5ca22bc2">handlebars_cache_mmap::refcount</a></div><div class="ttdeci">long refcount</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00111">handlebars_cache_mmap.c:111</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a05dd28d3d3bf0fc057e5cb4c160443ba"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a05dd28d3d3bf0fc057e5cb4c160443ba">handlebars_cache_mmap::data_length</a></div><div class="ttdeci">size_t data_length</div><div class="ttdoc">The length in bytes of the currently used part of the data segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00095">handlebars_cache_mmap.c:95</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_ae62d0123ba88d34c14e6aa31cff58a6b"><div class="ttname"><a href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">handlebars_cache::internal</a></div><div class="ttdeci">void * internal</div><div class="ttdoc">Opaque pointer for implementation use. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00118">handlebars_cache.h:118</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html"><div class="ttname"><a href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00063">handlebars_cache_mmap.c:63</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a4f6245176e76ca20c7087559c7a5f0bb"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a4f6245176e76ca20c7087559c7a5f0bb">protect</a></div><div class="ttdeci">static void protect(struct handlebars_cache *cache, bool on)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00143">handlebars_cache_mmap.c:143</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a106761eefc3d370d212d906297ccef3f"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a106761eefc3d370d212d906297ccef3f">unlock</a></div><div class="ttdeci">static void unlock(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00169">handlebars_cache_mmap.c:169</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_ad0a5032df05a781d5741e59353720971"><div class="ttname"><a href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">handlebars_cache_mmap::table</a></div><div class="ttdeci">struct table_entry ** table</div><div class="ttdoc">The pointer to the table segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00077">handlebars_cache_mmap.c:77</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a9e911424e11626d1ca5fa4ad0fe12f79"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a9e911424e11626d1ca5fa4ad0fe12f79">handlebars_cache_mmap::table_entries</a></div><div class="ttdeci">size_t table_entries</div><div class="ttdoc">The number of used slots in the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00086">handlebars_cache_mmap.c:86</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a25bd7b8b00a11adafa646b226ad9607f"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a25bd7b8b00a11adafa646b226ad9607f">lock</a></div><div class="ttdeci">static void lock(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00153">handlebars_cache_mmap.c:153</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a620b2172f6534dfd74567c8559890d81"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a620b2172f6534dfd74567c8559890d81">handlebars_cache_mmap::in_reset</a></div><div class="ttdeci">bool in_reset</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00103">handlebars_cache_mmap.c:103</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a97204788ab4999d7fa6db5c8add14ed5"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a97204788ab4999d7fa6db5c8add14ed5">handlebars_cache_mmap::table_size</a></div><div class="ttdeci">size_t table_size</div><div class="ttdoc">The size in bytes of the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00080">handlebars_cache_mmap.c:80</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af79331ff1183a715cb149247f955d0a7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structhandlebars__cache__stat.html">handlebars_cache_stat</a> cache_stat </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td>
          <td class="paramname"><em>cache</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00390">390</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;{</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> * intern = (<span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *) cache-&gt;<a class="code" href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">internal</a>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keyword">struct</span> <a class="code" href="structhandlebars__cache__stat.html">handlebars_cache_stat</a> stat = {0};</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    stat.<a class="code" href="structhandlebars__cache__stat.html#a9d449960eec42c25ebd572f0d86e6d83">name</a> = <span class="stringliteral">&quot;mmap&quot;</span>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    stat.total_size = intern-&gt;size;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    stat.total_table_size = intern-&gt;table_size;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    stat.total_data_size = intern-&gt;data_size;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    stat.total_entries = intern-&gt;table_count;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    stat.current_entries = intern-&gt;table_entries;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    stat.current_table_size = intern-&gt;table_entries * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structtable__entry.html">table_entry</a>);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    stat.current_data_size = intern-&gt;data_length;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    stat.current_size = stat.current_table_size + stat.current_data_size;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    stat.hits = intern-&gt;hits;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    stat.misses = intern-&gt;misses;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    stat.refcount = intern-&gt;refcount;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    stat.collisions = intern-&gt;collisions;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">return</span> stat;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;}</div><div class="ttc" id="structhandlebars__cache_html_ae62d0123ba88d34c14e6aa31cff58a6b"><div class="ttname"><a href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">handlebars_cache::internal</a></div><div class="ttdeci">void * internal</div><div class="ttdoc">Opaque pointer for implementation use. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00118">handlebars_cache.h:118</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html"><div class="ttname"><a href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00063">handlebars_cache_mmap.c:63</a></div></div>
<div class="ttc" id="structhandlebars__cache__stat_html_a9d449960eec42c25ebd572f0d86e6d83"><div class="ttname"><a href="structhandlebars__cache__stat.html#a9d449960eec42c25ebd572f0d86e6d83">handlebars_cache_stat::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00071">handlebars_cache.h:71</a></div></div>
<div class="ttc" id="structhandlebars__cache__stat_html"><div class="ttname"><a href="structhandlebars__cache__stat.html">handlebars_cache_stat</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00070">handlebars_cache.h:70</a></div></div>
<div class="ttc" id="structtable__entry_html"><div class="ttname"><a href="structtable__entry.html">table_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00114">handlebars_cache_mmap.c:114</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abad5da6309de6d623994e1a0f3493994"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a>* handlebars_cache_mmap_ctor </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__context.html">handlebars_context</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>entries</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct a new mmap cache. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The handlebars context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>The size of the mmap block, in bytes </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">entries</td><td>The fixed number of entries in the hash table </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The cache </dd></dl>

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00413">413</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache.html">handlebars_cache</a> * cache = <a class="code" href="handlebars__private_8h.html#a82f25723efb47b667ac4b68d8c8bfba9">MC</a>(<a class="code" href="handlebars__memory_8h.html#a4a17829b92cce6ae02bc3174fd6c0e30">handlebars_talloc_zero</a>(context, <span class="keyword">struct</span> <a class="code" href="structhandlebars__cache.html">handlebars_cache</a>));</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="handlebars_8c.html#a1f4fa306534133f7349a77eeee628c42">handlebars_context_bind</a>(context, <a class="code" href="handlebars_8h.html#aeaa554d04fd9ac8b882e4fdf0dc44264">HBSCTX</a>(cache));</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    cache-&gt;<a class="code" href="structhandlebars__cache.html#a5e03e6bcdb242893423b04205d430121">max_age</a> = -1;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    cache-&gt;<a class="code" href="structhandlebars__cache.html#a40efcf612dfc3076f029b6be9a3e3ff5">add</a> = &amp;<a class="code" href="handlebars__cache__mmap_8c.html#ac55c4b65fbb66d868640c5892cf8b181">cache_add</a>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    cache-&gt;<a class="code" href="structhandlebars__cache.html#aaec95f3accb1044fff9ab768995c5df4">find</a> = &amp;<a class="code" href="handlebars__cache__mmap_8c.html#ab97827ab3064e100bab8d45a88320bb9">cache_find</a>;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    cache-&gt;<a class="code" href="structhandlebars__cache.html#a705c63123f96ca05b90f296ce8631569">gc</a> = &amp;<a class="code" href="handlebars__cache__mmap_8c.html#adb3159a37e6e5e2b339e2bd4159f51dc">cache_gc</a>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    cache-&gt;<a class="code" href="structhandlebars__cache.html#af21639fb5e6beb8bb6223e1fc5bfd2d8">release</a> = &amp;<a class="code" href="handlebars__cache__mmap_8c.html#a62b4d5cb0eae7108d0df7f1af2395f65">cache_release</a>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    cache-&gt;<a class="code" href="structhandlebars__cache.html#ad7050f50c3b7e3d93bcc35544a287c6c">stat</a> = &amp;<a class="code" href="handlebars__cache__mmap_8c.html#af79331ff1183a715cb149247f955d0a7">cache_stat</a>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    cache-&gt;<a class="code" href="structhandlebars__cache.html#a7bc84fe7c357a726073a3942e46d8d1f">reset</a> = &amp;<a class="code" href="handlebars__cache__mmap_8c.html#aac5cf4d9696fde58dbde385f86b9efc8">cache_reset</a>;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    talloc_set_destructor(cache, <a class="code" href="handlebars__cache__mmap_8c.html#a64d298d4e018b19fed9ed107eb040c3c">cache_dtor</a>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">// Get page size</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="preprocessor">#if defined(_SC_PAGESIZE) &amp;&amp; _SC_PAGESIZE != -1</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#af91f634fbc8d26e705035b0613f7d077">page_size</a> = (size_t) sysconf(_SC_PAGESIZE);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="preprocessor">#elif defined(PAGE_SIZE)</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#af91f634fbc8d26e705035b0613f7d077">page_size</a> = PAGE_SIZE;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="preprocessor">#error &quot;Unable to query page size&quot;</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// Calculate sizes</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordtype">size_t</span> intern_size = <a class="code" href="handlebars__cache__mmap_8c.html#a74942634f14b677d6420778c681e5eee">align_size</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a>));</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordtype">size_t</span> shm_size = <a class="code" href="handlebars__cache__mmap_8c.html#a74942634f14b677d6420778c681e5eee">align_size</a>(size);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordtype">size_t</span> table_size = <a class="code" href="handlebars__cache__mmap_8c.html#a74942634f14b677d6420778c681e5eee">align_size</a>(entries * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtable__entry.html">table_entry</a> *));</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordtype">size_t</span> data_size = shm_size - table_size - intern_size;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">if</span>( table_size &gt;= shm_size ) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <a class="code" href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a>(<a class="code" href="handlebars__cache__mmap_8c.html#af195e2296079bbf21ae1c19823f0f036">CONTEXT</a>, <a class="code" href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a>, <span class="stringliteral">&quot;Table size must not be greater than segment size&quot;</span>);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> * intern = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED | MAP_ANONYMOUS, -1, 0);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">if</span>( intern == MAP_FAILED ) {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <a class="code" href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a>(<a class="code" href="handlebars__cache__mmap_8c.html#af195e2296079bbf21ae1c19823f0f036">CONTEXT</a>, <a class="code" href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a>, <span class="stringliteral">&quot;Failed to mmap: %s&quot;</span>, strerror(errno));</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    }</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    cache-&gt;<a class="code" href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">internal</a> = intern;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    memset(intern, 0, intern_size);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <a class="code" href="handlebars__string_8h.html#a63c99b5ce4c89deb54bb53514278027a">memcpy</a>(intern, <a class="code" href="handlebars__cache__mmap_8c.html#ac681967740693099a0ea2318b241af65">head</a>, <span class="keyword">sizeof</span>(<a class="code" href="handlebars__cache__mmap_8c.html#ac681967740693099a0ea2318b241af65">head</a>));</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a127651b8f7a6422e52a940b03e327869">version</a> = <a class="code" href="handlebars_8c.html#ab47ffc947fd2d7d4488f85a269e289af">handlebars_version</a>();</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a4016bb37756b65c2bc2e3620fe0da001">size</a> = shm_size;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a30c0a33691326c7f3877e3d98ed6896c">intern_size</a> = <a class="code" href="structhandlebars__cache__mmap.html#a30c0a33691326c7f3877e3d98ed6896c">intern_size</a>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a97204788ab4999d7fa6db5c8add14ed5">table_size</a> = <a class="code" href="structhandlebars__cache__mmap.html#a97204788ab4999d7fa6db5c8add14ed5">table_size</a>;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a8450774fdeadcddcb022b007eb315ba4">data_size</a> = <a class="code" href="structhandlebars__cache__mmap.html#a8450774fdeadcddcb022b007eb315ba4">data_size</a>;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#aea5569d60298a88a1012523db0e91c40">table_count</a> = entries; <span class="comment">//table_size / sizeof(struct table_entry *);</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">table</a> = ((<span class="keywordtype">void</span> *) intern) + <a class="code" href="structhandlebars__cache__mmap.html#a30c0a33691326c7f3877e3d98ed6896c">intern_size</a>;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a7e07fa52d80d3bfe23ef2f191334c178">data</a> = ((<span class="keywordtype">void</span> *) intern) + intern_size + <a class="code" href="structhandlebars__cache__mmap.html#a97204788ab4999d7fa6db5c8add14ed5">table_size</a>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="preprocessor">#if USE_SPINLOCK</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordtype">int</span> rc = pthread_spin_init(&amp;intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a9a06d1bee217ccc81929c6d194425142">write_lock</a>, PTHREAD_PROCESS_SHARED);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    pthread_mutexattr_t mattr;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    pthread_mutexattr_init(&amp;mattr);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    pthread_mutexattr_setpshared(&amp;mattr, PTHREAD_PROCESS_SHARED);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordtype">int</span> rc = pthread_mutex_init(&amp;intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a9a06d1bee217ccc81929c6d194425142">write_lock</a>, &amp;mattr);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span>( rc != 0 ) {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <a class="code" href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a>(<a class="code" href="handlebars__cache__mmap_8c.html#af195e2296079bbf21ae1c19823f0f036">CONTEXT</a>, <a class="code" href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a>, <span class="stringliteral">&quot;Failed to init lock: %s (%d)&quot;</span>, strerror(rc), rc);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <a class="code" href="handlebars__cache__mmap_8c.html#aac5cf4d9696fde58dbde385f86b9efc8">cache_reset</a>(cache);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">return</span> cache;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div><div class="ttc" id="handlebars__cache__mmap_8c_html_af79331ff1183a715cb149247f955d0a7"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#af79331ff1183a715cb149247f955d0a7">cache_stat</a></div><div class="ttdeci">static struct handlebars_cache_stat cache_stat(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00390">handlebars_cache_mmap.c:390</a></div></div>
<div class="ttc" id="handlebars__private_8h_html_a82f25723efb47b667ac4b68d8c8bfba9"><div class="ttname"><a href="handlebars__private_8h.html#a82f25723efb47b667ac4b68d8c8bfba9">MC</a></div><div class="ttdeci">#define MC(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__private_8h_source.html#l00039">handlebars_private.h:39</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a127651b8f7a6422e52a940b03e327869"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a127651b8f7a6422e52a940b03e327869">handlebars_cache_mmap::version</a></div><div class="ttdeci">int version</div><div class="ttdoc">The version of handlebars this block was initialized with. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00074">handlebars_cache_mmap.c:74</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_aea5569d60298a88a1012523db0e91c40"><div class="ttname"><a href="structhandlebars__cache__mmap.html#aea5569d60298a88a1012523db0e91c40">handlebars_cache_mmap::table_count</a></div><div class="ttdeci">size_t table_count</div><div class="ttdoc">The number of slots in the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00083">handlebars_cache_mmap.c:83</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_aac5cf4d9696fde58dbde385f86b9efc8"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#aac5cf4d9696fde58dbde385f86b9efc8">cache_reset</a></div><div class="ttdeci">static void cache_reset(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00231">handlebars_cache_mmap.c:231</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_ae62d0123ba88d34c14e6aa31cff58a6b"><div class="ttname"><a href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">handlebars_cache::internal</a></div><div class="ttdeci">void * internal</div><div class="ttdoc">Opaque pointer for implementation use. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00118">handlebars_cache.h:118</a></div></div>
<div class="ttc" id="handlebars_8c_html_ae53cf83b47627706cdc4143e5c6a4afe"><div class="ttname"><a href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a></div><div class="ttdeci">void handlebars_throw(struct handlebars_context *context, enum handlebars_error_type num, const char *msg,...)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8c_source.html#l00299">handlebars.c:299</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html"><div class="ttname"><a href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00063">handlebars_cache_mmap.c:63</a></div></div>
<div class="ttc" id="handlebars_8c_html_a1f4fa306534133f7349a77eeee628c42"><div class="ttname"><a href="handlebars_8c.html#a1f4fa306534133f7349a77eeee628c42">handlebars_context_bind</a></div><div class="ttdeci">void handlebars_context_bind(struct handlebars_context *parent, struct handlebars_context *child)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8c_source.html#l00086">handlebars.c:86</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a9a06d1bee217ccc81929c6d194425142"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a9a06d1bee217ccc81929c6d194425142">handlebars_cache_mmap::write_lock</a></div><div class="ttdeci">pthread_spinlock_t write_lock</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00106">handlebars_cache_mmap.c:106</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_adb3159a37e6e5e2b339e2bd4159f51dc"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#adb3159a37e6e5e2b339e2bd4159f51dc">cache_gc</a></div><div class="ttdeci">static int cache_gc(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00267">handlebars_cache_mmap.c:267</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_ac681967740693099a0ea2318b241af65"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#ac681967740693099a0ea2318b241af65">head</a></div><div class="ttdeci">static const char head[]</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00059">handlebars_cache_mmap.c:59</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_af21639fb5e6beb8bb6223e1fc5bfd2d8"><div class="ttname"><a href="structhandlebars__cache.html#af21639fb5e6beb8bb6223e1fc5bfd2d8">handlebars_cache::release</a></div><div class="ttdeci">handlebars_cache_release_func release</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00126">handlebars_cache.h:126</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a64d298d4e018b19fed9ed107eb040c3c"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a64d298d4e018b19fed9ed107eb040c3c">cache_dtor</a></div><div class="ttdeci">static void cache_dtor(struct handlebars_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00221">handlebars_cache_mmap.c:221</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_ad0a5032df05a781d5741e59353720971"><div class="ttname"><a href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">handlebars_cache_mmap::table</a></div><div class="ttdeci">struct table_entry ** table</div><div class="ttdoc">The pointer to the table segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00077">handlebars_cache_mmap.c:77</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_ac55c4b65fbb66d868640c5892cf8b181"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#ac55c4b65fbb66d868640c5892cf8b181">cache_add</a></div><div class="ttdeci">static void cache_add(struct handlebars_cache *cache, struct handlebars_string *key, struct handlebars_module *module)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00329">handlebars_cache_mmap.c:329</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a62b4d5cb0eae7108d0df7f1af2395f65"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a62b4d5cb0eae7108d0df7f1af2395f65">cache_release</a></div><div class="ttdeci">static void cache_release(struct handlebars_cache *cache, struct handlebars_string *tmpl, struct handlebars_module *module)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00384">handlebars_cache_mmap.c:384</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_a7bc84fe7c357a726073a3942e46d8d1f"><div class="ttname"><a href="structhandlebars__cache.html#a7bc84fe7c357a726073a3942e46d8d1f">handlebars_cache::reset</a></div><div class="ttdeci">handlebars_cache_reset_func reset</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00130">handlebars_cache.h:130</a></div></div>
<div class="ttc" id="handlebars_8h_html_aeaa554d04fd9ac8b882e4fdf0dc44264"><div class="ttname"><a href="handlebars_8h.html#aeaa554d04fd9ac8b882e4fdf0dc44264">HBSCTX</a></div><div class="ttdeci">#define HBSCTX(ctx)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8h_source.html#l00377">handlebars.h:377</a></div></div>
<div class="ttc" id="handlebars__memory_8h_html_a4a17829b92cce6ae02bc3174fd6c0e30"><div class="ttname"><a href="handlebars__memory_8h.html#a4a17829b92cce6ae02bc3174fd6c0e30">handlebars_talloc_zero</a></div><div class="ttdeci">#define handlebars_talloc_zero</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__memory_8h_source.html#l00053">handlebars_memory.h:53</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_aaec95f3accb1044fff9ab768995c5df4"><div class="ttname"><a href="structhandlebars__cache.html#aaec95f3accb1044fff9ab768995c5df4">handlebars_cache::find</a></div><div class="ttdeci">handlebars_cache_find_func find</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00122">handlebars_cache.h:122</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_af91f634fbc8d26e705035b0613f7d077"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#af91f634fbc8d26e705035b0613f7d077">page_size</a></div><div class="ttdeci">static size_t page_size</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00061">handlebars_cache_mmap.c:61</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a4016bb37756b65c2bc2e3620fe0da001"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a4016bb37756b65c2bc2e3620fe0da001">handlebars_cache_mmap::size</a></div><div class="ttdeci">size_t size</div><div class="ttdoc">The size of the memory block. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00068">handlebars_cache_mmap.c:68</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a30c0a33691326c7f3877e3d98ed6896c"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a30c0a33691326c7f3877e3d98ed6896c">handlebars_cache_mmap::intern_size</a></div><div class="ttdeci">size_t intern_size</div><div class="ttdoc">The page-aligned size of this struct. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00071">handlebars_cache_mmap.c:71</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_ab97827ab3064e100bab8d45a88320bb9"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#ab97827ab3064e100bab8d45a88320bb9">cache_find</a></div><div class="ttdeci">static struct handlebars_module * cache_find(struct handlebars_cache *cache, struct handlebars_string *key)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00274">handlebars_cache_mmap.c:274</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a74942634f14b677d6420778c681e5eee"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a74942634f14b677d6420778c681e5eee">align_size</a></div><div class="ttdeci">static size_t align_size(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00122">handlebars_cache_mmap.c:122</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a8450774fdeadcddcb022b007eb315ba4"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a8450774fdeadcddcb022b007eb315ba4">handlebars_cache_mmap::data_size</a></div><div class="ttdeci">size_t data_size</div><div class="ttdoc">The size in bytes of the data segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00092">handlebars_cache_mmap.c:92</a></div></div>
<div class="ttc" id="structhandlebars__cache_html"><div class="ttname"><a href="structhandlebars__cache.html">handlebars_cache</a></div><div class="ttdoc">In-memory opcode cache. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00113">handlebars_cache.h:113</a></div></div>
<div class="ttc" id="handlebars__string_8h_html_a63c99b5ce4c89deb54bb53514278027a"><div class="ttname"><a href="handlebars__string_8h.html#a63c99b5ce4c89deb54bb53514278027a">memcpy</a></div><div class="ttdeci">memcpy(st-&gt;val, str, len)</div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a7e07fa52d80d3bfe23ef2f191334c178"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a7e07fa52d80d3bfe23ef2f191334c178">handlebars_cache_mmap::data</a></div><div class="ttdeci">void * data</div><div class="ttdoc">The pointer to the data segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00089">handlebars_cache_mmap.c:89</a></div></div>
<div class="ttc" id="handlebars_8c_html_ab47ffc947fd2d7d4488f85a269e289af"><div class="ttname"><a href="handlebars_8c.html#ab47ffc947fd2d7d4488f85a269e289af">handlebars_version</a></div><div class="ttdeci">int handlebars_version(void)</div><div class="ttdoc">Get the library version as an integer. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8c_source.html#l00044">handlebars.c:44</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_a705c63123f96ca05b90f296ce8631569"><div class="ttname"><a href="structhandlebars__cache.html#a705c63123f96ca05b90f296ce8631569">handlebars_cache::gc</a></div><div class="ttdeci">handlebars_cache_gc_func gc</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00124">handlebars_cache.h:124</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_a40efcf612dfc3076f029b6be9a3e3ff5"><div class="ttname"><a href="structhandlebars__cache.html#a40efcf612dfc3076f029b6be9a3e3ff5">handlebars_cache::add</a></div><div class="ttdeci">handlebars_cache_add_func add</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00120">handlebars_cache.h:120</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_ad7050f50c3b7e3d93bcc35544a287c6c"><div class="ttname"><a href="structhandlebars__cache.html#ad7050f50c3b7e3d93bcc35544a287c6c">handlebars_cache::stat</a></div><div class="ttdeci">handlebars_cache_stat_func stat</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00128">handlebars_cache.h:128</a></div></div>
<div class="ttc" id="structtable__entry_html"><div class="ttname"><a href="structtable__entry.html">table_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00114">handlebars_cache_mmap.c:114</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_af195e2296079bbf21ae1c19823f0f036"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#af195e2296079bbf21ae1c19823f0f036">CONTEXT</a></div><div class="ttdeci">#define CONTEXT</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00411">handlebars_cache_mmap.c:411</a></div></div>
<div class="ttc" id="structhandlebars__cache_html_a5e03e6bcdb242893423b04205d430121"><div class="ttname"><a href="structhandlebars__cache.html#a5e03e6bcdb242893423b04205d430121">handlebars_cache::max_age</a></div><div class="ttdeci">double max_age</div><div class="ttdoc">The max amount of time to keep an entry, in seconds, or zero to disable. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00133">handlebars_cache.h:133</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a97204788ab4999d7fa6db5c8add14ed5"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a97204788ab4999d7fa6db5c8add14ed5">handlebars_cache_mmap::table_size</a></div><div class="ttdeci">size_t table_size</div><div class="ttdoc">The size in bytes of the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00080">handlebars_cache_mmap.c:80</a></div></div>
<div class="ttc" id="handlebars_8h_html_a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67"><div class="ttname"><a href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a></div><div class="ttdoc">Indicates that a generic error has occurred. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8h_source.html#l00119">handlebars.h:119</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a25bd7b8b00a11adafa646b226ad9607f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void lock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td>
          <td class="paramname"><em>cache</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00153">153</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;{</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> * intern = (<span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *) cache-&gt;<a class="code" href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">internal</a>;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordtype">int</span> rc;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// Lock</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;#<span class="keywordflow">if</span> <a class="code" href="handlebars__cache__mmap_8c.html#a1c071bfb72a8294b36426ac580e59b46">USE_SPINLOCK</a></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    rc = pthread_spin_lock(&amp;intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a9a06d1bee217ccc81929c6d194425142">write_lock</a>);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    rc = pthread_mutex_lock(&amp;intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a9a06d1bee217ccc81929c6d194425142">write_lock</a>);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span>( rc != 0 ) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <a class="code" href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a>(<a class="code" href="handlebars_8h.html#aeaa554d04fd9ac8b882e4fdf0dc44264">HBSCTX</a>(cache), <a class="code" href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a>, <span class="stringliteral">&quot;pthread lock error: %s (%d)&quot;</span>, strerror(rc), rc);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div><div class="ttc" id="structhandlebars__cache_html_ae62d0123ba88d34c14e6aa31cff58a6b"><div class="ttname"><a href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">handlebars_cache::internal</a></div><div class="ttdeci">void * internal</div><div class="ttdoc">Opaque pointer for implementation use. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00118">handlebars_cache.h:118</a></div></div>
<div class="ttc" id="handlebars_8c_html_ae53cf83b47627706cdc4143e5c6a4afe"><div class="ttname"><a href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a></div><div class="ttdeci">void handlebars_throw(struct handlebars_context *context, enum handlebars_error_type num, const char *msg,...)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8c_source.html#l00299">handlebars.c:299</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html"><div class="ttname"><a href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00063">handlebars_cache_mmap.c:63</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a9a06d1bee217ccc81929c6d194425142"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a9a06d1bee217ccc81929c6d194425142">handlebars_cache_mmap::write_lock</a></div><div class="ttdeci">pthread_spinlock_t write_lock</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00106">handlebars_cache_mmap.c:106</a></div></div>
<div class="ttc" id="handlebars_8h_html_aeaa554d04fd9ac8b882e4fdf0dc44264"><div class="ttname"><a href="handlebars_8h.html#aeaa554d04fd9ac8b882e4fdf0dc44264">HBSCTX</a></div><div class="ttdeci">#define HBSCTX(ctx)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8h_source.html#l00377">handlebars.h:377</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a1c071bfb72a8294b36426ac580e59b46"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a1c071bfb72a8294b36426ac580e59b46">USE_SPINLOCK</a></div><div class="ttdeci">#define USE_SPINLOCK</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00056">handlebars_cache_mmap.c:56</a></div></div>
<div class="ttc" id="handlebars_8h_html_a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67"><div class="ttname"><a href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a></div><div class="ttdoc">Indicates that a generic error has occurred. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8h_source.html#l00119">handlebars.h:119</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4f6245176e76ca20c7087559c7a5f0bb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void protect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td>
          <td class="paramname"><em>cache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>on</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00143">143</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> * intern = (<span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *) cache-&gt;<a class="code" href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">internal</a>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordtype">int</span> prot = on ? PROT_READ : PROT_READ | PROT_WRITE;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordtype">int</span> rc = mprotect(intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">table</a>, intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a97204788ab4999d7fa6db5c8add14ed5">table_size</a> + intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a8450774fdeadcddcb022b007eb315ba4">data_size</a>, prot);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">if</span>( rc != 0 ) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <a class="code" href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a>(<a class="code" href="handlebars_8h.html#aeaa554d04fd9ac8b882e4fdf0dc44264">HBSCTX</a>(cache), <a class="code" href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a>, <span class="stringliteral">&quot;mprotect error: %s (%d)&quot;</span>, strerror(rc), rc);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;}</div><div class="ttc" id="structhandlebars__cache_html_ae62d0123ba88d34c14e6aa31cff58a6b"><div class="ttname"><a href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">handlebars_cache::internal</a></div><div class="ttdeci">void * internal</div><div class="ttdoc">Opaque pointer for implementation use. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00118">handlebars_cache.h:118</a></div></div>
<div class="ttc" id="handlebars_8c_html_ae53cf83b47627706cdc4143e5c6a4afe"><div class="ttname"><a href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a></div><div class="ttdeci">void handlebars_throw(struct handlebars_context *context, enum handlebars_error_type num, const char *msg,...)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8c_source.html#l00299">handlebars.c:299</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html"><div class="ttname"><a href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00063">handlebars_cache_mmap.c:63</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_ad0a5032df05a781d5741e59353720971"><div class="ttname"><a href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">handlebars_cache_mmap::table</a></div><div class="ttdeci">struct table_entry ** table</div><div class="ttdoc">The pointer to the table segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00077">handlebars_cache_mmap.c:77</a></div></div>
<div class="ttc" id="handlebars_8h_html_aeaa554d04fd9ac8b882e4fdf0dc44264"><div class="ttname"><a href="handlebars_8h.html#aeaa554d04fd9ac8b882e4fdf0dc44264">HBSCTX</a></div><div class="ttdeci">#define HBSCTX(ctx)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8h_source.html#l00377">handlebars.h:377</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a8450774fdeadcddcb022b007eb315ba4"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a8450774fdeadcddcb022b007eb315ba4">handlebars_cache_mmap::data_size</a></div><div class="ttdeci">size_t data_size</div><div class="ttdoc">The size in bytes of the data segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00092">handlebars_cache_mmap.c:92</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a97204788ab4999d7fa6db5c8add14ed5"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a97204788ab4999d7fa6db5c8add14ed5">handlebars_cache_mmap::table_size</a></div><div class="ttdeci">size_t table_size</div><div class="ttdoc">The size in bytes of the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00080">handlebars_cache_mmap.c:80</a></div></div>
<div class="ttc" id="handlebars_8h_html_a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67"><div class="ttname"><a href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a></div><div class="ttdoc">Indicates that a generic error has occurred. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8h_source.html#l00119">handlebars.h:119</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1733dcac1d772cc39819b5427c8a1703"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool table_exists </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *&#160;</td>
          <td class="paramname"><em>intern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *&#160;</td>
          <td class="paramname"><em>string</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00185">185</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;{</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">size_t</span> offset = <a class="code" href="handlebars__string_8h.html#ad9a8e1ff73d128e3acad70c42ba2fb41">HBS_STR_HASH</a>(<span class="keywordtype">string</span>) % intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#aea5569d60298a88a1012523db0e91c40">table_count</a>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">return</span> NULL != intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">table</a>[offset];</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div><div class="ttc" id="structhandlebars__cache__mmap_html_aea5569d60298a88a1012523db0e91c40"><div class="ttname"><a href="structhandlebars__cache__mmap.html#aea5569d60298a88a1012523db0e91c40">handlebars_cache_mmap::table_count</a></div><div class="ttdeci">size_t table_count</div><div class="ttdoc">The number of slots in the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00083">handlebars_cache_mmap.c:83</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_ad0a5032df05a781d5741e59353720971"><div class="ttname"><a href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">handlebars_cache_mmap::table</a></div><div class="ttdeci">struct table_entry ** table</div><div class="ttdoc">The pointer to the table segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00077">handlebars_cache_mmap.c:77</a></div></div>
<div class="ttc" id="handlebars__string_8h_html_ad9a8e1ff73d128e3acad70c42ba2fb41"><div class="ttname"><a href="handlebars__string_8h.html#ad9a8e1ff73d128e3acad70c42ba2fb41">HBS_STR_HASH</a></div><div class="ttdeci">#define HBS_STR_HASH(string)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__string_8h_source.html#l00047">handlebars_string.h:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2a23bf622f8c72bdcadb41f78ab4d49c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structtable__entry.html">table_entry</a>* table_find </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *&#160;</td>
          <td class="paramname"><em>intern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *&#160;</td>
          <td class="paramname"><em>string</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00191">191</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">size_t</span> offset = <a class="code" href="handlebars__string_8h.html#ad9a8e1ff73d128e3acad70c42ba2fb41">HBS_STR_HASH</a>(<span class="keywordtype">string</span>) % intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#aea5569d60298a88a1012523db0e91c40">table_count</a>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">return</span> intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">table</a>[offset];</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div><div class="ttc" id="structhandlebars__cache__mmap_html_aea5569d60298a88a1012523db0e91c40"><div class="ttname"><a href="structhandlebars__cache__mmap.html#aea5569d60298a88a1012523db0e91c40">handlebars_cache_mmap::table_count</a></div><div class="ttdeci">size_t table_count</div><div class="ttdoc">The number of slots in the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00083">handlebars_cache_mmap.c:83</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_ad0a5032df05a781d5741e59353720971"><div class="ttname"><a href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">handlebars_cache_mmap::table</a></div><div class="ttdeci">struct table_entry ** table</div><div class="ttdoc">The pointer to the table segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00077">handlebars_cache_mmap.c:77</a></div></div>
<div class="ttc" id="handlebars__string_8h_html_ad9a8e1ff73d128e3acad70c42ba2fb41"><div class="ttname"><a href="handlebars__string_8h.html#ad9a8e1ff73d128e3acad70c42ba2fb41">HBS_STR_HASH</a></div><div class="ttdeci">#define HBS_STR_HASH(string)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__string_8h_source.html#l00047">handlebars_string.h:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2b8d6650dd1fe5567000229958d68c69"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void table_set </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *&#160;</td>
          <td class="paramname"><em>intern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtable__entry.html">table_entry</a> *&#160;</td>
          <td class="paramname"><em>entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00197">197</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;{</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">size_t</span> offset = <a class="code" href="handlebars__string_8h.html#ad9a8e1ff73d128e3acad70c42ba2fb41">HBS_STR_HASH</a>(entry-&gt;<a class="code" href="structtable__entry.html#aa866208546b2c698d292d66968992733">key</a>) % intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#aea5569d60298a88a1012523db0e91c40">table_count</a>;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">if</span>( entry == NULL ) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">table</a>[offset] = NULL;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">table</a>[offset] = <a class="code" href="handlebars__cache__mmap_8c.html#a374ab73285cc1fa0624b029e1f7a043c">append</a>(intern, entry, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtable__entry.html">table_entry</a>));</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;}</div><div class="ttc" id="structhandlebars__cache__mmap_html_aea5569d60298a88a1012523db0e91c40"><div class="ttname"><a href="structhandlebars__cache__mmap.html#aea5569d60298a88a1012523db0e91c40">handlebars_cache_mmap::table_count</a></div><div class="ttdeci">size_t table_count</div><div class="ttdoc">The number of slots in the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00083">handlebars_cache_mmap.c:83</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_ad0a5032df05a781d5741e59353720971"><div class="ttname"><a href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">handlebars_cache_mmap::table</a></div><div class="ttdeci">struct table_entry ** table</div><div class="ttdoc">The pointer to the table segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00077">handlebars_cache_mmap.c:77</a></div></div>
<div class="ttc" id="structtable__entry_html_aa866208546b2c698d292d66968992733"><div class="ttname"><a href="structtable__entry.html#aa866208546b2c698d292d66968992733">table_entry::key</a></div><div class="ttdeci">struct handlebars_string * key</div><div class="ttdoc">The offset from the beginning of the memory block at which the key for the entry resides. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00116">handlebars_cache_mmap.c:116</a></div></div>
<div class="ttc" id="handlebars__string_8h_html_ad9a8e1ff73d128e3acad70c42ba2fb41"><div class="ttname"><a href="handlebars__string_8h.html#ad9a8e1ff73d128e3acad70c42ba2fb41">HBS_STR_HASH</a></div><div class="ttdeci">#define HBS_STR_HASH(string)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__string_8h_source.html#l00047">handlebars_string.h:47</a></div></div>
<div class="ttc" id="structtable__entry_html"><div class="ttname"><a href="structtable__entry.html">table_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00114">handlebars_cache_mmap.c:114</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a374ab73285cc1fa0624b029e1f7a043c"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a374ab73285cc1fa0624b029e1f7a043c">append</a></div><div class="ttdeci">static void * append(struct handlebars_cache_mmap *intern, void *source, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00131">handlebars_cache_mmap.c:131</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad0548dbe473ec67a6e1365752df9b476"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void table_unset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *&#160;</td>
          <td class="paramname"><em>intern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__string.html">handlebars_string</a> *&#160;</td>
          <td class="paramname"><em>string</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00207">207</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;{</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordtype">size_t</span> offset = <a class="code" href="handlebars__string_8h.html#ad9a8e1ff73d128e3acad70c42ba2fb41">HBS_STR_HASH</a>(<span class="keywordtype">string</span>) % intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#aea5569d60298a88a1012523db0e91c40">table_count</a>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">table</a>[offset] = NULL;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;}</div><div class="ttc" id="structhandlebars__cache__mmap_html_aea5569d60298a88a1012523db0e91c40"><div class="ttname"><a href="structhandlebars__cache__mmap.html#aea5569d60298a88a1012523db0e91c40">handlebars_cache_mmap::table_count</a></div><div class="ttdeci">size_t table_count</div><div class="ttdoc">The number of slots in the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00083">handlebars_cache_mmap.c:83</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_ad0a5032df05a781d5741e59353720971"><div class="ttname"><a href="structhandlebars__cache__mmap.html#ad0a5032df05a781d5741e59353720971">handlebars_cache_mmap::table</a></div><div class="ttdeci">struct table_entry ** table</div><div class="ttdoc">The pointer to the table segment. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00077">handlebars_cache_mmap.c:77</a></div></div>
<div class="ttc" id="handlebars__string_8h_html_ad9a8e1ff73d128e3acad70c42ba2fb41"><div class="ttname"><a href="handlebars__string_8h.html#ad9a8e1ff73d128e3acad70c42ba2fb41">HBS_STR_HASH</a></div><div class="ttdeci">#define HBS_STR_HASH(string)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__string_8h_source.html#l00047">handlebars_string.h:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a106761eefc3d370d212d906297ccef3f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void unlock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhandlebars__cache.html">handlebars_cache</a> *&#160;</td>
          <td class="paramname"><em>cache</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00169">169</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;{</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> * intern = (<span class="keyword">struct </span><a class="code" href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a> *) cache-&gt;<a class="code" href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">internal</a>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">int</span> rc;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// Unlock</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;#<span class="keywordflow">if</span> <a class="code" href="handlebars__cache__mmap_8c.html#a1c071bfb72a8294b36426ac580e59b46">USE_SPINLOCK</a></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    rc = pthread_spin_unlock(&amp;intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a9a06d1bee217ccc81929c6d194425142">write_lock</a>);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    rc = pthread_mutex_unlock(&amp;intern-&gt;<a class="code" href="structhandlebars__cache__mmap.html#a9a06d1bee217ccc81929c6d194425142">write_lock</a>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span>( rc != 0 ) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <a class="code" href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a>(<a class="code" href="handlebars_8h.html#aeaa554d04fd9ac8b882e4fdf0dc44264">HBSCTX</a>(cache), <a class="code" href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a>, <span class="stringliteral">&quot;pthread unlock error: %s (%d)&quot;</span>, strerror(rc), rc);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div><div class="ttc" id="structhandlebars__cache_html_ae62d0123ba88d34c14e6aa31cff58a6b"><div class="ttname"><a href="structhandlebars__cache.html#ae62d0123ba88d34c14e6aa31cff58a6b">handlebars_cache::internal</a></div><div class="ttdeci">void * internal</div><div class="ttdoc">Opaque pointer for implementation use. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache_8h_source.html#l00118">handlebars_cache.h:118</a></div></div>
<div class="ttc" id="handlebars_8c_html_ae53cf83b47627706cdc4143e5c6a4afe"><div class="ttname"><a href="handlebars_8c.html#ae53cf83b47627706cdc4143e5c6a4afe">handlebars_throw</a></div><div class="ttdeci">void handlebars_throw(struct handlebars_context *context, enum handlebars_error_type num, const char *msg,...)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8c_source.html#l00299">handlebars.c:299</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html"><div class="ttname"><a href="structhandlebars__cache__mmap.html">handlebars_cache_mmap</a></div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00063">handlebars_cache_mmap.c:63</a></div></div>
<div class="ttc" id="structhandlebars__cache__mmap_html_a9a06d1bee217ccc81929c6d194425142"><div class="ttname"><a href="structhandlebars__cache__mmap.html#a9a06d1bee217ccc81929c6d194425142">handlebars_cache_mmap::write_lock</a></div><div class="ttdeci">pthread_spinlock_t write_lock</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00106">handlebars_cache_mmap.c:106</a></div></div>
<div class="ttc" id="handlebars_8h_html_aeaa554d04fd9ac8b882e4fdf0dc44264"><div class="ttname"><a href="handlebars_8h.html#aeaa554d04fd9ac8b882e4fdf0dc44264">HBSCTX</a></div><div class="ttdeci">#define HBSCTX(ctx)</div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8h_source.html#l00377">handlebars.h:377</a></div></div>
<div class="ttc" id="handlebars__cache__mmap_8c_html_a1c071bfb72a8294b36426ac580e59b46"><div class="ttname"><a href="handlebars__cache__mmap_8c.html#a1c071bfb72a8294b36426ac580e59b46">USE_SPINLOCK</a></div><div class="ttdeci">#define USE_SPINLOCK</div><div class="ttdef"><b>Definition:</b> <a href="handlebars__cache__mmap_8c_source.html#l00056">handlebars_cache_mmap.c:56</a></div></div>
<div class="ttc" id="handlebars_8h_html_a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67"><div class="ttname"><a href="handlebars_8h.html#a0d850aff222bf50c105a0fb2207c80eea85e9b3c086d96c8eff9e51e387bbdf67">HANDLEBARS_ERROR</a></div><div class="ttdoc">Indicates that a generic error has occurred. </div><div class="ttdef"><b>Definition:</b> <a href="handlebars_8h_source.html#l00119">handlebars.h:119</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ac681967740693099a0ea2318b241af65"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char head[] = &quot;handlebars shared opcode cache&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00059">59</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>

</div>
</div>
<a class="anchor" id="a799a580f85b3c4f9a3689f904c4f21d3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t PADDING = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00060">60</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>

</div>
</div>
<a class="anchor" id="af91f634fbc8d26e705035b0613f7d077"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t page_size</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="handlebars__cache__mmap_8c_source.html#l00061">61</a> of file <a class="el" href="handlebars__cache__mmap_8c_source.html">handlebars_cache_mmap.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="handlebars__cache__mmap_8c.html">handlebars_cache_mmap.c</a></li>
    <li class="footer">Generated on Thu Mar 9 2017 12:59:45 for handlebars.c by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
